<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Settings | JAMB Trackr</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css">
    <link rel="stylesheet" href="css/settings.css">
    
    <script>
        // IMMEDIATE THEME APPLY (Prevents Flash)
        (function() {
            const session = localStorage.getItem('currentUserEmail');
            if (!session) window.location.replace('auth.html');
            if (localStorage.getItem('globalTheme') === 'dark') {
                document.documentElement.classList.add('dark-mode');
            }
        })();
    </script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo"><i class="fas fa-sliders-h"></i> <span>JAMB<span>Trackr</span></span></div>
            <div class="nav-right">
                <div class="hamburger" id="hamburger"><span></span><span></span><span></span></div>
            </div>
        </div>
    </nav>

    <aside class="sidebar" id="sidebar">
       <ul class="side-links">
            <li><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
            <li><a href="dashboard.html"><i class="fas fa-chart-pie"></i> Dashboard</a></li>
            <li><a href="subjects.html"><i class="fas fa-book"></i> Subjects</a></li>
            <li><a href="novel.html"><i class="fas fa-book"></i> Novel</a></li>
            <li><a href="progress.html"><i class="fas fa-chart-line"></i> Analytics</a></li>
            <li><a href="reader.html"><i class="fas fa-file-pdf"></i> Reader</a></li>
            <li><a href="settings.html" class="active"><i class="fas fa-cog"></i> Settings</a></li>
            <li><a href="logout.html" style="color: #ff5252;"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
        </ul>
    </aside>

    <main class="main-content">
        <header class="settings-header" data-aos="fade-down">
            <h1>Settings</h1>
            <p>Manage your account, data, and study preferences.</p>
        </header>

        <div class="settings-grid">
            <section class="settings-card" data-aos="fade-up">
                <h3><i class="fas fa-palette"></i> Preferences</h3>
                <div class="setting-item">
                    <div class="info">
                        <strong>Dark Mode</strong>
                        <p>Apply dark theme across all pages.</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="themeToggle">
                        <span class="slider round"></span>
                    </label>
                </div>

                <div class="setting-item">
                    <div class="info">
                        <strong>Daily Study Goal</strong>
                        <p>Set your target hours per day.</p>
                    </div>
                    <div class="input-group">
                        <input type="number" id="dailyGoal" min="1" max="24">
                        <span>Hrs</span>
                    </div>
                </div>
            </section>

            <section class="settings-card" data-aos="fade-up" data-aos-delay="100">
                <h3><i class="fas fa-shield-alt"></i> Data & Privacy</h3>
                <div class="setting-item">
                    <div class="info">
                        <strong>Export Progress</strong>
                        <p>Generate a printable report of your performance.</p>
                    </div>
                    <button class="btn-secondary" onclick="exportProgress()"><i class="fas fa-print"></i> Print Report</button>
                </div>

                <div class="setting-item danger-zone">
                    <div class="info">
                        <strong class="text-danger">Reset All Progress</strong>
                        <p>Wipe all timers, streaks, and subject data.</p>
                    </div>
                    <button class="btn-danger" id="resetBtn">Reset Data</button>
                </div>
            </section>
        </div>
    </main>

    <div id="toast" class="toast">Settings Saved!</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    <script>
        AOS.init();
        const email = localStorage.getItem('currentUserEmail');

        // 1. Initialize Settings
        document.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('globalTheme') === 'dark') {
                document.getElementById('themeToggle').checked = true;
            }
            document.getElementById('dailyGoal').value = localStorage.getItem(`goal_${email}`) || 2;
        });

        // 2. Dark Mode Toggle (Global)
        document.getElementById('themeToggle').addEventListener('change', (e) => {
            if (e.target.checked) {
                document.documentElement.classList.add('dark-mode');
                localStorage.setItem('globalTheme', 'dark');
            } else {
                document.documentElement.classList.remove('dark-mode');
                localStorage.setItem('globalTheme', 'light');
            }
            showToast("Theme Preference Saved");
        });

        // 3. Daily Goal Logic
        document.getElementById('dailyGoal').addEventListener('change', (e) => {
            localStorage.setItem(`goal_${email}`, e.target.value);
            showToast(`Goal set to ${e.target.value} hours`);
        });

        // 4. Print Progress (Export)
        function exportProgress() {
            window.location.href = 'progress.html?mode=print';
        }

        // 5. Reset All Data
        document.getElementById('resetBtn').addEventListener('click', () => {
            if (confirm("Are you sure? This will wipe ALL your study hours and streaks!")) {
                const subjects = ['english', 'mathematics', 'physics', 'chemistry', 'biology', 'economics', 'government', 'literature'];
                subjects.forEach(s => localStorage.removeItem(`study_${email}_${s}`));
                
                let userObj = JSON.parse(localStorage.getItem(`user_${email}`));
                if (userObj) {
                    userObj.stats = { streak: 0, totalSeconds: 0 };
                    localStorage.setItem(`user_${email}`, JSON.stringify(userObj));
                }
                
                showToast("Data Reset Successful!");
                setTimeout(() => window.location.href = 'dashboard.html', 1500);
            }
        });

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg; t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        document.getElementById('hamburger').addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('active');
        });
    </script>
</body>
</html>